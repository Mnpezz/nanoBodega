<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nano calulator and items point of sale</title>
    <script src="https://pay.nano.to/latest.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 50px;
        }
        #welcome, #emailForm {
            display: none;
        }
        #items, #calculator {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        .item {
            margin: 10px;
            text-align: center;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .item img {
            width: 100px;
            height: 100px;
        }
        .item:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .item p {
            margin: 0;
            font-size: 1.2em;
        }
        #calculator {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }
        #calcDisplay {
            font-size: 1.5em;
            margin-bottom: 10px;
            width: 150px;
            text-align: right;
        }
        .calc-row {
            display: flex;
            justify-content: center;
        }
        .calc-button {
            font-size: 1.5em;
            margin: 5px;
            width: 50px;
            height: 50px;
        }
        #total {
            font-size: 2em;
            margin-top: 20px;
        }
        button, input[type="email"] {
            font-size: 1.5em;
            margin: 5px;
        }
        #payButton {
            margin-top: 20px;
            display: none;
            margin-left: auto;
            margin-right: auto;
        }
        #plusbutton, #minusbutton {    
            width: 80px;
        }
    </style>
</head>
<body>
    <h1>Nano Point of Sale Website</h1>
    <button id="loginButton">Sign In with Nano</button>
    <div id="emailForm">
        <h2>Please enter your email for payment notifications:</h2>
        <input type="email" id="userEmail" required>
        <button onclick="submitEmail()">Submit</button>
    </div>
    <div id="welcome">
        <h2>Hello <span id="userEmailDisplay"></span>. <br> Your nano address is <span id="userAddress"></span></h2>
    </div>
    <div id="items">
        <div class="item" onclick="addItem(0.10)">
            <img src="https://via.placeholder.com/100" alt="Item 1">
            <p>Item 1 - $0.10</p>
        </div>
        <div class="item" onclick="addItem(0.20)">
            <img src="https://via.placeholder.com/100" alt="Item 2">
            <p>Item 2 - $0.20</p>
        </div>
        <div class="item" onclick="addItem(0.15)">
            <img src="https://via.placeholder.com/100" alt="Item 3">
            <p>Item 3 - $0.15</p>
        </div>
        <div class="item" onclick="addItem(0.25)">
            <img src="https://via.placeholder.com/100" alt="Item 4">
            <p>Item 4 - $0.25</p>
        </div>
    </div>
    <div id="calculator">
        <input type="text" id="calcDisplay" value="0" readonly>
        <div class="calc-row">
            <input type="button" class="calc-button" value="1" onclick="appendNumber(1)">
            <input type="button" class="calc-button" value="2" onclick="appendNumber(2)">
            <input type="button" class="calc-button" value="3" onclick="appendNumber(3)">
            
        </div>
        <div class="calc-row">
            <input type="button" class="calc-button" value="4" onclick="appendNumber(4)">
            <input type="button" class="calc-button" value="5" onclick="appendNumber(5)">
            <input type="button" class="calc-button" value="6" onclick="appendNumber(6)">
        </div>
        <div class="calc-row">
            <input type="button" class="calc-button" value="7" onclick="appendNumber(7)">
            <input type="button" class="calc-button" value="8" onclick="appendNumber(8)">
            <input type="button" class="calc-button" value="9" onclick="appendNumber(9)">
        </div>
        <div class="calc-row">
            <input type="button" class="calc-button" value="." onclick="appendNumber('.')">
            <input type="button" class="calc-button" value="0" onclick="appendNumber(0)">
<button class="calc-button" onclick="clearDisplay()">C</button>
            
        </div>
<div class="calc-row">
<button id="plusbutton" class="calc-button" onclick="addToTotal()">+</button>
<button id="minusbutton" class="calc-button" onclick="subtractFromTotal()">-</button>
</div>
        
    </div>
    <div id="total">
        Total: $<span id="totalAmount">0.00</span>
    </div>
    <button id="payButton" onclick="initiatePayment()">Pay with Nano</button>

    <script>
        let userAddress = null;
        let userEmail = null;
        let totalAmount = 0.00;
        let buffer = '';

        document.getElementById('loginButton').addEventListener('click', function() {
            NanoPay.open({ 
                title: "Login to the nano point of sale",
                address: '@mnpezz', // Your App's Address
                amount: 0.00001, // Small Amount
                success: (block) => {
                    userAddress = block.username || block.address;
                    document.getElementById('loginButton').style.display = 'none';
                    document.getElementById('emailForm').style.display = 'block';
                }
            });
        });

        function submitEmail() {
            userEmail = document.getElementById('userEmail').value;
            if (userEmail) {
                document.getElementById('userEmailDisplay').textContent = userEmail;
                document.getElementById('userAddress').textContent = userAddress;
                document.getElementById('emailForm').style.display = 'none';
                document.getElementById('welcome').style.display = 'block';
                document.getElementById('payButton').style.display = 'block';
            }
        }

        function addItem(price) {
            totalAmount += price;
            document.getElementById('totalAmount').textContent = totalAmount.toFixed(2);
        }

        function appendNumber(number) {
            const display = document.getElementById('calcDisplay');
            if (display.value === '0') {
                display.value = number;
            } else {
                display.value += number;
            }
            buffer = display.value;
        }

        function clearDisplay() {
            document.getElementById('calcDisplay').value = '0';
            buffer = '';
        }

        function addToTotal() {
            const amount = parseFloat(buffer);
            totalAmount += amount;
            document.getElementById('totalAmount').textContent = totalAmount.toFixed(2);
            clearDisplay();
        }

        function subtractFromTotal() {
            const amount = parseFloat(buffer);
            totalAmount -= amount;
            if (totalAmount < 0) {
                totalAmount = 0;
            }
            document.getElementById('totalAmount').textContent = totalAmount.toFixed(2);
            clearDisplay();
        }

        function initiatePayment() {
            NanoPay.open({
                title: "Payment",
                address: userAddress, //Recipient Address
                notify: userEmail, // User's email for receipt
                contact: false, // User's email
                shipping: false, // User's shipping address
                currency: 'USD', // Currency type
                line_items: [
                    { name: "Total Purchase", price: totalAmount }
                ],
                note: userEmail,
                success: (block) => {
                    console.log(block);
                    // Handle successful payment here
                    // Reset total amount to 0 after successful payment
                    totalAmount = 0.00;
                    document.getElementById('totalAmount').textContent = totalAmount.toFixed(2);
                },
                cancel: () => {
                    console.log("User cancelled");
                }
            });
        }
    </script>
</body>
</html>

